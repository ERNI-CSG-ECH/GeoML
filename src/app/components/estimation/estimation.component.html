<mat-card class="estimation">
  <div *ngIf="tasks$ | async as tasks" class="estimation__progress">
    <span *ngFor="let task of tasks; let idx = index" class="estimation__progress-step"
      [ngClass]="{'active': idx <= try}"></span>
  </div>
  <mat-card-title class="estimation__title">
    <ng-container *ngIf="correctValue === undefined" i18n>Wie hoch sch채tzen sie das Risiko?</ng-container>
    <ng-container *ngIf="correctValue !== undefined && correctValue === selectedValue" i18n>Ihre Einsch채tzung war
      richtig</ng-container>
    <ng-container *ngIf="correctValue !== undefined && correctValue !== selectedValue" i18n>Die richtige Einsch채tzung
      w채re Stufe {{ correctValue }}</ng-container>
  </mat-card-title>
  <mat-card-content *ngIf="tasks$ | async as tasks" class="estimation__content">
    <div class="estimation__content-image">
      <div [ngClass]="{'cropped-result': checked,'cropped-initial': !checked}">
        <img #estimationImage src="{{ apiEndpoint }}/files/{{ tasks[try] }}_{{ checked ? 'result' : 'initial' }}.png" />
      </div>
      <div *ngIf="checked" class="estimation__content-result" style="--correctValue: {{correctValue}}">
        <svg-icon class="estimation__content-result-indicator" name="arrow"></svg-icon >
      </div>
    </div>
<!--     <span *ngIf="checked" class="estimation__bot-comment"><svg-icon name="bot"></svg-icon> Diesmal bin ich richtig gelegen</span> -->
    <mat-divider class="estimation__divider"></mat-divider>
    <div class="estimation__values">
      <div class="estimation__values-button-container" *ngFor="let task of tasks; let idx = index">
        <button mat-fab class="estimation__values-button" [ngClass]="{
          'estimation__values-selected': idx + 1 === selectedValue && correctValue === undefined,
          'estimation__values-solution': correctValue !== undefined,
          'estimation__values-solution-false':
            correctValue !== selectedValue && idx + 1 === selectedValue && correctValue !== undefined,
          'estimation__values-solution-correct':
            correctValue === selectedValue && idx + 1 === selectedValue && correctValue !== undefined,
          'estimation__values-solution-true':
            correctValue !== selectedValue && idx + 1 === correctValue && correctValue !== undefined
        }" (click)="selectedValue = idx + 1">
          {{ idx + 1 }}
        </button>
        <span *ngIf="correctValue!==undefined&&idx + 1===botValue" class="estimation__values-button-badge">
          <svg-icon name="bot"></svg-icon>
        </span>
      </div>
    </div>
    <mat-divider class="estimation__divider"></mat-divider>
  </mat-card-content>
  <mat-card-actions class="estimation__actions">
    <div class="estimation__actions-points">
      <div i18n>Ihre Punkte</div>
      <h2>{{ score === undefined ? 0:score.human }}</h2>
      <span class="estimation__actions-points-update" [ngClass]="{'hidden': this.pointGain === undefined}">{{
        this.pointGain }}</span>
    </div>
    <button color="primary" mat-raised-button i18n class="estimation__actions-next"
      [disabled]="selectedValue === undefined" (click)="correctValue === undefined ? check() : next()">
      <ng-container *ngIf="correctValue === undefined">{{ checkText }}</ng-container>
      <ng-container *ngIf="correctValue !== undefined && try < 4">{{ nextText }}</ng-container>
      <ng-container *ngIf="correctValue !== undefined && try === 4">{{ resultText }}</ng-container>
    </button>
  </mat-card-actions>
</mat-card>
